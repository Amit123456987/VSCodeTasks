local LOBBY = KEYS[1] -- Set local GAME = KEYS[2] -- Hash local USER_ID = ARGV[1] -- Stringredis.call('SADD', LOBBY, USER_ID)if redis.call('SCARD', LOBBY) == 4 thenlocal members = table.concat(redis.call('SMEMBERS', LOBBY), ",") redis.call('DEL', LOBBY) -- empty lobbylocal game_id = redis.sha1hex(members) redis.call('HSET', GAME, game_id, members) return {game_id, members}endreturn nil